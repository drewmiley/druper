<!DOCTYPE html>

<html>
<body>
    <input type='file' name='file1' id='file1'/>
    <input type='file' name='file2' id='file2'/>
    <div>
        INCLUDE (Supersedes OMIT)
        <input type='number' name='include-from' min='0' id='include-from' />
        <input type='number' name='include-to' min='0' id='include-to' />
    </div>
    <div>
        OMIT
        <input type='number' name='omit-from' min='0' id='omit-from' />
        <input type='number' name='omit-to' min='0' id='omit-to' />
    </div>
    <button id='compare'>Compare</button>
    <div id='result'></div>
    <div id='diff'></div>
    <div id='onenottwo'></div>
    <div id='twonotone'></div>
</body>
<script>
    let fileOne;
    let fileTwo;

    document.getElementById('file1').onchange = function() {
        const reader = new FileReader();
        reader.onload = function(progressEvent) {
            fileOne = this.result.split(/\r\n|\n/);
        }
        reader.readAsText(this.files[0]);
    }

    document.getElementById('file2').onchange = function() {
        const reader = new FileReader();
        reader.onload = function(progressEvent) {
            fileTwo = this.result.split(/\r\n|\n/);
        }
        reader.readAsText(this.files[0]);
    }

    const modifiedRecords = fileStrings => {
        let modifiedStrings;
        const includeFrom = parseInt(document.getElementById('include-from').value, 10);
        const includeTo = parseInt(document.getElementById('include-to').value, 10);
        if (includeFrom && includeTo && includeTo > includeFrom) {
            modifiedStrings = fileStrings.map(d => d.substring(includeFrom, includeTo));
        } else {
            const omitFrom = parseInt(document.getElementById('omit-from').value, 10);
            const omitTo = parseInt(document.getElementById('omit-to').value, 10);
            if (omitFrom && omitTo && omitTo > omitFrom) {
                modifiedStrings = fileStrings.map(d => `${ d.substring(0, omitFrom)}${ d.substring(omitTo) }`);
            }
        }
        return (modifiedStrings || fileStrings).map(d => {
            return { key: d, value: d };
        });
    }

    const printToDiv = (selector, initialText, records = []) => {
        const div = document.querySelector(selector);
        div.innerText = `${ initialText }\n`;
        records.forEach(d => div.innerText += `${ d }\n`);
    }

    const compare = () => {
        let set1 = modifiedRecords(fileOne);
        let set2 = modifiedRecords(fileTwo);

        set1 = new Set(fileOne);
        set2 = new Set(fileTwo);

        printToDiv('#diff', 'Diff');

        const onenottwo = new Set([...set1].filter(d => !set2.has(d)));
        printToDiv('#onenottwo', 'In One Not Two', onenottwo);

        const twonotone = new Set([...set2].filter(d => !set1.has(d)));
        printToDiv('#twonotone', 'In Two Not One', twonotone);

        const failureRate = Math.max(onenottwo.size, twonotone.size) /
            Math.max(set1.size, set2.size);
        let result = document.querySelector('#result');
        result.innerText = `Records in File One: ${ set1.size }
            Records in File Two: ${ set2.size }
            Diff Records: ${ 0 }
            In One Not Two: ${ onenottwo.size }
            In Two Not One: ${ twonotone.size }
            Failure Rate: ${ failureRate }`;
        if (failureRate == 0) {
            result.style.background = 'green';
        } else if (failureRate > 0 && failureRate <= 0.005) {
            result.style.background = 'gold';
        } else {
            result.style.background = 'red';
        }
    }

    document.getElementById('compare').onclick = compare;
</script>
</html>
